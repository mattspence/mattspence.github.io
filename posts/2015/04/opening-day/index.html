<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Matthew Spence">
<meta name="dcterms.date" content="2015-04-09">

<title>Matt Spence - Opening Day</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">Matt Spence</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../posts/index.html">
 <span class="menu-text">Posts</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mattspence"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Opening Day</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">baseball</div>
    <div class="quarto-category">code</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Matthew Spence </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 9, 2015</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">February 24, 2023</p>
    </div>
  </div>
    
  </div>
  

</header>

<p>In honor of Opening Day (and the Nats’ loss), I wanted to see which teams have had the most success on opening day.</p>
<p>It’s…the Mets (?)</p>
<div class="cell" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> os, requests, zipfile, io</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">from</span> IPython.display <span class="im">import</span> HTML<span class="co">#, Markdown</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">#from itables import show</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a>DATADIR <span class="op">=</span> os.path.join(os.getenv(<span class="st">"MY_PROJECT_DIR"</span>), <span class="st">"data"</span>, <span class="st">"gl"</span>) <span class="co"># Using Quarto's _environment.local file (not saved to GitHub) to set the directory where this project lives</span></span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(DATADIR):</span>
<span id="cb1-9"><a href="#cb1-9"></a>    os.makedirs(DATADIR)</span>
<span id="cb1-10"><a href="#cb1-10"></a></span>
<span id="cb1-11"><a href="#cb1-11"></a>DOWNLOADFROMRS <span class="op">=</span> <span class="va">True</span></span>
<span id="cb1-12"><a href="#cb1-12"></a></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="cf">if</span> DOWNLOADFROMRS:</span>
<span id="cb1-14"><a href="#cb1-14"></a>    r <span class="op">=</span> requests.get(<span class="st">"https://www.retrosheet.org/CurrentNames.csv"</span>)</span>
<span id="cb1-15"><a href="#cb1-15"></a>    <span class="cf">with</span> <span class="bu">open</span>(os.path.join(DATADIR,<span class="st">"CurrentNames.csv"</span>),<span class="st">"w"</span>) <span class="im">as</span> f:</span>
<span id="cb1-16"><a href="#cb1-16"></a>        f.write(<span class="st">"current_team_id,hist_franchise_id,league,division,location,nickname,alt_nickname,first_used,last_used,city,state</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb1-17"><a href="#cb1-17"></a>        f.write(r.text)</span>
<span id="cb1-18"><a href="#cb1-18"></a></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="co">"""</span></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="co">From https://www.retrosheet.org/Nickname.htm:</span></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="co">The fields are:</span></span>
<span id="cb1-22"><a href="#cb1-22"></a></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="co">Current franchise ID</span></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="co">Franchise ID (may the same as current one) for earlier data</span></span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="co">League</span></span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="co">Division (blank before divisional play)</span></span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="co">Location name (e.g. Brooklyn, Texas)</span></span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="co">Nickname</span></span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="co">Alternate nicknames (blank if none for the period)</span></span>
<span id="cb1-30"><a href="#cb1-30"></a><span class="co">Date of the first game with this combination</span></span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="co">Date of the last game with combination (blank if current one)</span></span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="co">City</span></span>
<span id="cb1-33"><a href="#cb1-33"></a><span class="co">State</span></span>
<span id="cb1-34"><a href="#cb1-34"></a><span class="co">"""</span></span>
<span id="cb1-35"><a href="#cb1-35"></a></span>
<span id="cb1-36"><a href="#cb1-36"></a><span class="cf">if</span> DOWNLOADFROMRS:</span>
<span id="cb1-37"><a href="#cb1-37"></a>    r <span class="op">=</span> requests.get(<span class="st">"https://www.retrosheet.org/gamelogs/glfields.txt"</span>)</span>
<span id="cb1-38"><a href="#cb1-38"></a>    <span class="cf">with</span> <span class="bu">open</span>(os.path.join(DATADIR, <span class="st">"glfields.txt"</span>),<span class="st">"w"</span>) <span class="im">as</span> f:</span>
<span id="cb1-39"><a href="#cb1-39"></a>        f.write(r.text)</span>
<span id="cb1-40"><a href="#cb1-40"></a></span>
<span id="cb1-41"><a href="#cb1-41"></a><span class="cf">if</span> DOWNLOADFROMRS:</span>
<span id="cb1-42"><a href="#cb1-42"></a>    <span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1980</span>,<span class="dv">2015</span>):</span>
<span id="cb1-43"><a href="#cb1-43"></a>        zip_file_url <span class="op">=</span> <span class="ss">f"https://www.retrosheet.org/gamelogs/gl</span><span class="sc">{</span>y<span class="sc">}</span><span class="ss">.zip"</span></span>
<span id="cb1-44"><a href="#cb1-44"></a>        r <span class="op">=</span> requests.get(zip_file_url)</span>
<span id="cb1-45"><a href="#cb1-45"></a>        z <span class="op">=</span> zipfile.ZipFile(io.BytesIO(r.content))</span>
<span id="cb1-46"><a href="#cb1-46"></a>        z.extractall(path<span class="op">=</span>DATADIR)</span>
<span id="cb1-47"><a href="#cb1-47"></a></span>
<span id="cb1-48"><a href="#cb1-48"></a>fields <span class="op">=</span> [<span class="st">'date'</span>,<span class="st">'visit_team_id'</span>,<span class="st">'visit_team_league'</span>,<span class="st">'visit_game_number'</span>,<span class="st">'home_team_id'</span>,<span class="st">'home_team_league'</span>,<span class="st">'home_game_number'</span>,<span class="st">'visit_final_score'</span>,<span class="st">'home_final_score'</span>]</span>
<span id="cb1-49"><a href="#cb1-49"></a>cols <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>]</span>
<span id="cb1-50"><a href="#cb1-50"></a></span>
<span id="cb1-51"><a href="#cb1-51"></a>namefields <span class="op">=</span> [<span class="st">'current_team_id'</span>,<span class="st">'hist_franchise_id'</span>,<span class="st">'league'</span>,<span class="st">'division'</span>,<span class="st">'location'</span>,<span class="st">'nickname'</span>,<span class="st">'alt_nickname'</span>,<span class="st">'first_used'</span>,<span class="st">'last_used'</span>,<span class="st">'city'</span>,<span class="st">'state'</span>]</span>
<span id="cb1-52"><a href="#cb1-52"></a></span>
<span id="cb1-53"><a href="#cb1-53"></a><span class="kw">def</span> assign_outcome(row):</span>
<span id="cb1-54"><a href="#cb1-54"></a>    <span class="cf">if</span> row.final_score<span class="op">&gt;</span>row.opponent_final_score:</span>
<span id="cb1-55"><a href="#cb1-55"></a>        <span class="cf">return</span> <span class="st">'W'</span></span>
<span id="cb1-56"><a href="#cb1-56"></a>    <span class="cf">elif</span> row.final_score<span class="op">&lt;</span>row.opponent_final_score:</span>
<span id="cb1-57"><a href="#cb1-57"></a>        <span class="cf">return</span> <span class="st">'L'</span></span>
<span id="cb1-58"><a href="#cb1-58"></a></span>
<span id="cb1-59"><a href="#cb1-59"></a><span class="kw">def</span> read_in_data(year):</span>
<span id="cb1-60"><a href="#cb1-60"></a>    dat <span class="op">=</span> pd.read_csv(<span class="ss">f"</span><span class="sc">{</span>DATADIR<span class="sc">}</span><span class="ss">/GL</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">.txt"</span>, header<span class="op">=</span><span class="va">None</span>,names<span class="op">=</span>fields, usecols<span class="op">=</span>cols, parse_dates<span class="op">=</span>[<span class="st">'date'</span>])</span>
<span id="cb1-61"><a href="#cb1-61"></a>    v <span class="op">=</span> dat.loc[dat.visit_game_number<span class="op">==</span><span class="dv">1</span>,].rename(columns<span class="op">=</span><span class="kw">lambda</span> x: x.replace(<span class="st">'visit_'</span>,<span class="st">''</span>)).rename(columns<span class="op">=</span><span class="kw">lambda</span> x: x.replace(<span class="st">'home_'</span>,<span class="st">'opponent_'</span>))</span>
<span id="cb1-62"><a href="#cb1-62"></a>    h <span class="op">=</span> dat.loc[dat.home_game_number<span class="op">==</span><span class="dv">1</span>,].rename(columns<span class="op">=</span><span class="kw">lambda</span> x: x.replace(<span class="st">'home_'</span>,<span class="st">''</span>)).rename(columns<span class="op">=</span><span class="kw">lambda</span> x: x.replace(<span class="st">'visit_'</span>,<span class="st">'opponent_'</span>))</span>
<span id="cb1-63"><a href="#cb1-63"></a>    games <span class="op">=</span> pd.concat([v,h], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-64"><a href="#cb1-64"></a>    games[<span class="st">'outcome'</span>] <span class="op">=</span> games.<span class="bu">apply</span>(assign_outcome,axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-65"><a href="#cb1-65"></a>    games[<span class="st">'season'</span>] <span class="op">=</span> year</span>
<span id="cb1-66"><a href="#cb1-66"></a>    <span class="cf">return</span> games</span>
<span id="cb1-67"><a href="#cb1-67"></a></span>
<span id="cb1-68"><a href="#cb1-68"></a>teamnames <span class="op">=</span> pd.read_csv(os.path.join(DATADIR,<span class="st">'CurrentNames.csv'</span>), parse_dates<span class="op">=</span>[<span class="st">'first_used'</span>,<span class="st">'last_used'</span>]) </span>
<span id="cb1-69"><a href="#cb1-69"></a></span>
<span id="cb1-70"><a href="#cb1-70"></a>df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb1-71"><a href="#cb1-71"></a><span class="cf">for</span> year <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1980</span>,<span class="dv">2015</span>):</span>
<span id="cb1-72"><a href="#cb1-72"></a>    g <span class="op">=</span> read_in_data(year)</span>
<span id="cb1-73"><a href="#cb1-73"></a>    df <span class="op">=</span> pd.concat([df,g], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-74"><a href="#cb1-74"></a></span>
<span id="cb1-75"><a href="#cb1-75"></a>teamsgrouped <span class="op">=</span> df.groupby(<span class="st">'team_id'</span>)</span>
<span id="cb1-76"><a href="#cb1-76"></a></span>
<span id="cb1-77"><a href="#cb1-77"></a>pct <span class="op">=</span> teamsgrouped.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.outcome.value_counts()<span class="op">/</span>x.outcome.size).<span class="bu">round</span>(<span class="dv">3</span>)<span class="op">*</span><span class="dv">100</span></span>
<span id="cb1-78"><a href="#cb1-78"></a>pct <span class="op">=</span> pct.unstack(<span class="dv">1</span>)</span>
<span id="cb1-79"><a href="#cb1-79"></a>pct <span class="op">=</span> pct.sort_values(<span class="st">'W'</span>, ascending<span class="op">=</span><span class="va">False</span>) <span class="co">## decent answer here, but let's merge in team names</span></span>
<span id="cb1-80"><a href="#cb1-80"></a></span>
<span id="cb1-81"><a href="#cb1-81"></a>pctteamids <span class="op">=</span> <span class="bu">list</span>(pct.index.values)</span>
<span id="cb1-82"><a href="#cb1-82"></a>pctteams <span class="op">=</span> teamnames[teamnames.hist_franchise_id.isin(pctteamids)].sort_values(<span class="st">'last_used'</span>).drop_duplicates(subset<span class="op">=</span><span class="st">'hist_franchise_id'</span>,keep<span class="op">=</span><span class="st">"last"</span>)</span>
<span id="cb1-83"><a href="#cb1-83"></a></span>
<span id="cb1-84"><a href="#cb1-84"></a>finaltable <span class="op">=</span> pct.merge(pctteams, left_index<span class="op">=</span><span class="va">True</span>, right_on<span class="op">=</span><span class="st">'hist_franchise_id'</span>, how<span class="op">=</span><span class="st">"left"</span>).reset_index().assign(Team <span class="op">=</span> <span class="kw">lambda</span> x: x[<span class="st">'location'</span>] <span class="op">+</span> <span class="st">" "</span> <span class="op">+</span> x[<span class="st">'nickname'</span>]).rename(columns<span class="op">=</span>{<span class="st">'W'</span>:<span class="st">'Wins'</span>,<span class="st">'L'</span>:<span class="st">'Losses'</span>})[[<span class="st">'Team'</span>,<span class="st">'Wins'</span>,<span class="st">'Losses'</span>]]</span>
<span id="cb1-85"><a href="#cb1-85"></a></span>
<span id="cb1-86"><a href="#cb1-86"></a>HTML(finaltable.to_html(index<span class="op">=</span><span class="va">False</span>))  <span class="co"># alternative to using the itables package</span></span>
<span id="cb1-87"><a href="#cb1-87"></a><span class="co"># with pd.option_context("display.float_format", "{:,.1f}%".format):</span></span>
<span id="cb1-88"><a href="#cb1-88"></a><span class="co">#     show(finaltable, dom="lrtp", lengthMenu = [5,10,len(finaltable)]) #paging=False to show full table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="1">
<div id="tbl-openingday-winpct" class="anchored">

<table class="dataframe table table-sm table-striped"><caption>Table&nbsp;1:  Opening Day Records, 1980 – 2014 </caption>
  <thead>
    <tr>
      <th>Team</th>
      <th>Wins</th>
      <th>Losses</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>New York Mets</td>
      <td>71.4</td>
      <td>28.6</td>
    </tr>
    <tr>
      <td>Baltimore Orioles</td>
      <td>65.7</td>
      <td>34.3</td>
    </tr>
    <tr>
      <td>Chicago White Sox</td>
      <td>65.7</td>
      <td>34.3</td>
    </tr>
    <tr>
      <td>Los Angeles Angels</td>
      <td>61.1</td>
      <td>38.9</td>
    </tr>
    <tr>
      <td>Seattle Mariners</td>
      <td>60.0</td>
      <td>40.0</td>
    </tr>
    <tr>
      <td>Arizona Diamondbacks</td>
      <td>58.8</td>
      <td>41.2</td>
    </tr>
    <tr>
      <td>Atlanta Braves</td>
      <td>57.1</td>
      <td>42.9</td>
    </tr>
    <tr>
      <td>Los Angeles Dodgers</td>
      <td>54.3</td>
      <td>45.7</td>
    </tr>
    <tr>
      <td>San Francisco Giants</td>
      <td>54.3</td>
      <td>45.7</td>
    </tr>
    <tr>
      <td>New York Yankees</td>
      <td>54.3</td>
      <td>45.7</td>
    </tr>
    <tr>
      <td>Cincinnati Reds</td>
      <td>54.3</td>
      <td>42.9</td>
    </tr>
    <tr>
      <td>Milwaukee Brewers</td>
      <td>54.3</td>
      <td>42.9</td>
    </tr>
    <tr>
      <td>Detroit Tigers</td>
      <td>54.3</td>
      <td>45.7</td>
    </tr>
    <tr>
      <td>Tampa Bay Rays</td>
      <td>52.9</td>
      <td>47.1</td>
    </tr>
    <tr>
      <td>Florida Marlins</td>
      <td>52.6</td>
      <td>47.4</td>
    </tr>
    <tr>
      <td>Toronto Blue Jays</td>
      <td>51.4</td>
      <td>48.6</td>
    </tr>
    <tr>
      <td>St. Louis Cardinals</td>
      <td>51.4</td>
      <td>48.6</td>
    </tr>
    <tr>
      <td>Colorado Rockies</td>
      <td>50.0</td>
      <td>50.0</td>
    </tr>
    <tr>
      <td>Texas Rangers</td>
      <td>48.6</td>
      <td>51.4</td>
    </tr>
    <tr>
      <td>Pittsburgh Pirates</td>
      <td>48.6</td>
      <td>51.4</td>
    </tr>
    <tr>
      <td>Montreal Expos</td>
      <td>48.0</td>
      <td>52.0</td>
    </tr>
    <tr>
      <td>California Angels</td>
      <td>47.1</td>
      <td>52.9</td>
    </tr>
    <tr>
      <td>Chicago Cubs</td>
      <td>45.7</td>
      <td>54.3</td>
    </tr>
    <tr>
      <td>Boston Red Sox</td>
      <td>45.7</td>
      <td>54.3</td>
    </tr>
    <tr>
      <td>Houston Astros</td>
      <td>42.9</td>
      <td>57.1</td>
    </tr>
    <tr>
      <td>Washington Nationals</td>
      <td>40.0</td>
      <td>60.0</td>
    </tr>
    <tr>
      <td>San Diego Padres</td>
      <td>40.0</td>
      <td>60.0</td>
    </tr>
    <tr>
      <td>Minnesota Twins</td>
      <td>40.0</td>
      <td>60.0</td>
    </tr>
    <tr>
      <td>Cleveland Indians</td>
      <td>40.0</td>
      <td>60.0</td>
    </tr>
    <tr>
      <td>Philadelphia Phillies</td>
      <td>37.1</td>
      <td>62.9</td>
    </tr>
    <tr>
      <td>Oakland Athletics</td>
      <td>37.1</td>
      <td>62.9</td>
    </tr>
    <tr>
      <td>Miami Marlins</td>
      <td>33.3</td>
      <td>66.7</td>
    </tr>
    <tr>
      <td>Kansas City Royals</td>
      <td>28.6</td>
      <td>71.4</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Here’s how I did it:</p>
<p>I downloaded<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> game logs from 1980 – 2014 from <a href="http://www.retrosheet.org/gamelogs/index.html">RetroSheet</a> and wrote the following script to analyze them. The key was changing the “dyadic” structure of the raw game logs (one row contains information about the two teams playing the game) into one that had one row for each team. I did this in the <code>read_in_data</code> function:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_in_data(year):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    dat <span class="op">=</span> pd.read_csv(<span class="ss">f"</span><span class="sc">{</span>DATADIR<span class="sc">}</span><span class="ss">/GL</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">.txt"</span>, header<span class="op">=</span><span class="va">None</span>,names<span class="op">=</span>fields, usecols<span class="op">=</span>cols, parse_dates<span class="op">=</span>[<span class="st">'date'</span>])</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    v <span class="op">=</span> dat.loc[dat.visit_game_number<span class="op">==</span><span class="dv">1</span>,].rename(columns<span class="op">=</span><span class="kw">lambda</span> x: x.replace(<span class="st">'visit_'</span>,<span class="st">''</span>)).rename(columns<span class="op">=</span><span class="kw">lambda</span> x: x.replace(<span class="st">'home_'</span>,<span class="st">'opponent_'</span>))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> dat.loc[dat.home_game_number<span class="op">==</span><span class="dv">1</span>,].rename(columns<span class="op">=</span><span class="kw">lambda</span> x: x.replace(<span class="st">'home_'</span>,<span class="st">''</span>)).rename(columns<span class="op">=</span><span class="kw">lambda</span> x: x.replace(<span class="st">'visit_'</span>,<span class="st">'opponent_'</span>))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    games <span class="op">=</span> pd.concat([v,h], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    games[<span class="st">'outcome'</span>] <span class="op">=</span> games.<span class="bu">apply</span>(assign_outcome,axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    games[<span class="st">'season'</span>] <span class="op">=</span> year</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> games</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s an example of one year’s worth of gamelog data once it’s been run through <code>read_in_data</code>. 2014 was a bit of an odd season, since the <a href="https://www.mlb.com/schedule/2014-03-22">Dodgers and the Diamondbacks started their seasons on March 22</a> by <a href="https://sabr.org/gamesproj/game/march-22-2014-opening-day-down-under-as-dodgers-defeat-diamondbacks/">playing three exhibition games in Syndey, Australia</a>. Each team went on to be another team’s opening day opponent – the Dodgers faced the Padres and the Diamondbacks went up against the Giants.</p>
<div class="cell page-columns page-full" data-execution_count="3">
<div class="cell-output cell-output-display column-page" data-execution_count="2">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>date</th>
      <th>team_id</th>
      <th>game_number</th>
      <th>opponent_team_id</th>
      <th>opponent_game_number</th>
      <th>final_score</th>
      <th>opponent_final_score</th>
      <th>outcome</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>2014-03-22</td>
      <td>LAN</td>
      <td>1</td>
      <td>ARI</td>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>W</td>
    </tr>
    <tr>
      <td>2014-03-22</td>
      <td>ARI</td>
      <td>1</td>
      <td>LAN</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>L</td>
    </tr>
    <tr>
      <td>2014-03-30</td>
      <td>SDN</td>
      <td>1</td>
      <td>LAN</td>
      <td>3</td>
      <td>3</td>
      <td>1</td>
      <td>W</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>MIA</td>
      <td>1</td>
      <td>COL</td>
      <td>1</td>
      <td>10</td>
      <td>1</td>
      <td>W</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>CIN</td>
      <td>1</td>
      <td>SLN</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>L</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>TEX</td>
      <td>1</td>
      <td>PHI</td>
      <td>1</td>
      <td>10</td>
      <td>14</td>
      <td>L</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>TBA</td>
      <td>1</td>
      <td>TOR</td>
      <td>1</td>
      <td>9</td>
      <td>2</td>
      <td>W</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>OAK</td>
      <td>1</td>
      <td>CLE</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>L</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>DET</td>
      <td>1</td>
      <td>KCA</td>
      <td>1</td>
      <td>4</td>
      <td>3</td>
      <td>W</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>CHA</td>
      <td>1</td>
      <td>MIN</td>
      <td>1</td>
      <td>5</td>
      <td>3</td>
      <td>W</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>BAL</td>
      <td>1</td>
      <td>BOS</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>W</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>ANA</td>
      <td>1</td>
      <td>SEA</td>
      <td>1</td>
      <td>3</td>
      <td>10</td>
      <td>L</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>PIT</td>
      <td>1</td>
      <td>CHN</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>W</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>CHN</td>
      <td>1</td>
      <td>PIT</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>L</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>WAS</td>
      <td>1</td>
      <td>NYN</td>
      <td>1</td>
      <td>9</td>
      <td>7</td>
      <td>W</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>ATL</td>
      <td>1</td>
      <td>MIL</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>L</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>COL</td>
      <td>1</td>
      <td>MIA</td>
      <td>1</td>
      <td>1</td>
      <td>10</td>
      <td>L</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>SLN</td>
      <td>1</td>
      <td>CIN</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>W</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>SFN</td>
      <td>1</td>
      <td>ARI</td>
      <td>3</td>
      <td>9</td>
      <td>8</td>
      <td>W</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>PHI</td>
      <td>1</td>
      <td>TEX</td>
      <td>1</td>
      <td>14</td>
      <td>10</td>
      <td>W</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>TOR</td>
      <td>1</td>
      <td>TBA</td>
      <td>1</td>
      <td>2</td>
      <td>9</td>
      <td>L</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>CLE</td>
      <td>1</td>
      <td>OAK</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>W</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>KCA</td>
      <td>1</td>
      <td>DET</td>
      <td>1</td>
      <td>3</td>
      <td>4</td>
      <td>L</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>MIN</td>
      <td>1</td>
      <td>CHA</td>
      <td>1</td>
      <td>3</td>
      <td>5</td>
      <td>L</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>BOS</td>
      <td>1</td>
      <td>BAL</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>L</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>SEA</td>
      <td>1</td>
      <td>ANA</td>
      <td>1</td>
      <td>10</td>
      <td>3</td>
      <td>W</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>MIL</td>
      <td>1</td>
      <td>ATL</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>W</td>
    </tr>
    <tr>
      <td>2014-03-31</td>
      <td>NYN</td>
      <td>1</td>
      <td>WAS</td>
      <td>1</td>
      <td>7</td>
      <td>9</td>
      <td>L</td>
    </tr>
    <tr>
      <td>2014-04-01</td>
      <td>NYA</td>
      <td>1</td>
      <td>HOU</td>
      <td>1</td>
      <td>2</td>
      <td>6</td>
      <td>L</td>
    </tr>
    <tr>
      <td>2014-04-01</td>
      <td>HOU</td>
      <td>1</td>
      <td>NYA</td>
      <td>1</td>
      <td>6</td>
      <td>2</td>
      <td>W</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<p>The results table includes two teams that have renamed themselves (the Angels and the Marlins), and one that moved and changed names (Expos). I’d like to update my script to deal with these, but should I really lump the Expos in with the Nats?</p>
<p>Also, I was relieved to see the Dodgers and the Giants were tied, at least.</p>


<!-- -->



<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>I did this manually back in 2015, but as I was porting this to the new site, I wrote a script to automatically download and unzip the files.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb3" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Opening Day"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2015-04-09</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="an">date-modified:</span><span class="co"> 2023-02-24 </span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [baseball, code, ]</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> "max-scherzer-031215.jpg"</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="an">fig-cap-location:</span><span class="co"> bottom</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="an">tbl-cap-location:</span><span class="co"> top</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">  html: </span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>In honor of Opening Day (and the Nats' loss), I wanted to see which teams have had the most success on opening day. </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>It's...the Mets (?)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-line-numbers: true</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-openingday-winpct</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Opening Day Records, 1980 -- 2014"</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os, requests, zipfile, io</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> HTML<span class="co">#, Markdown</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co">#from itables import show</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>DATADIR <span class="op">=</span> os.path.join(os.getenv(<span class="st">"MY_PROJECT_DIR"</span>), <span class="st">"data"</span>, <span class="st">"gl"</span>) <span class="co"># Using Quarto's _environment.local file (not saved to GitHub) to set the directory where this project lives</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(DATADIR):</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    os.makedirs(DATADIR)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>DOWNLOADFROMRS <span class="op">=</span> <span class="va">True</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> DOWNLOADFROMRS:</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> requests.get(<span class="st">"https://www.retrosheet.org/CurrentNames.csv"</span>)</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(os.path.join(DATADIR,<span class="st">"CurrentNames.csv"</span>),<span class="st">"w"</span>) <span class="im">as</span> f:</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>        f.write(<span class="st">"current_team_id,hist_franchise_id,league,division,location,nickname,alt_nickname,first_used,last_used,city,state</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>        f.write(r.text)</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="co">From https://www.retrosheet.org/Nickname.htm:</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="co">The fields are:</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="co">Current franchise ID</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="co">Franchise ID (may the same as current one) for earlier data</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="co">League</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="co">Division (blank before divisional play)</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="co">Location name (e.g. Brooklyn, Texas)</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="co">Nickname</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="co">Alternate nicknames (blank if none for the period)</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="co">Date of the first game with this combination</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="co">Date of the last game with combination (blank if current one)</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a><span class="co">City</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a><span class="co">State</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> DOWNLOADFROMRS:</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> requests.get(<span class="st">"https://www.retrosheet.org/gamelogs/glfields.txt"</span>)</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(os.path.join(DATADIR, <span class="st">"glfields.txt"</span>),<span class="st">"w"</span>) <span class="im">as</span> f:</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>        f.write(r.text)</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> DOWNLOADFROMRS:</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1980</span>,<span class="dv">2015</span>):</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>        zip_file_url <span class="op">=</span> <span class="ss">f"https://www.retrosheet.org/gamelogs/gl</span><span class="sc">{</span>y<span class="sc">}</span><span class="ss">.zip"</span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>        r <span class="op">=</span> requests.get(zip_file_url)</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>        z <span class="op">=</span> zipfile.ZipFile(io.BytesIO(r.content))</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>        z.extractall(path<span class="op">=</span>DATADIR)</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>fields <span class="op">=</span> [<span class="st">'date'</span>,<span class="st">'visit_team_id'</span>,<span class="st">'visit_team_league'</span>,<span class="st">'visit_game_number'</span>,<span class="st">'home_team_id'</span>,<span class="st">'home_team_league'</span>,<span class="st">'home_game_number'</span>,<span class="st">'visit_final_score'</span>,<span class="st">'home_final_score'</span>]</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>]</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>namefields <span class="op">=</span> [<span class="st">'current_team_id'</span>,<span class="st">'hist_franchise_id'</span>,<span class="st">'league'</span>,<span class="st">'division'</span>,<span class="st">'location'</span>,<span class="st">'nickname'</span>,<span class="st">'alt_nickname'</span>,<span class="st">'first_used'</span>,<span class="st">'last_used'</span>,<span class="st">'city'</span>,<span class="st">'state'</span>]</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> assign_outcome(row):</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> row.final_score<span class="op">&gt;</span>row.opponent_final_score:</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'W'</span></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> row.final_score<span class="op">&lt;</span>row.opponent_final_score:</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'L'</span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_in_data(year):</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>    dat <span class="op">=</span> pd.read_csv(<span class="ss">f"</span><span class="sc">{</span>DATADIR<span class="sc">}</span><span class="ss">/GL</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">.txt"</span>, header<span class="op">=</span><span class="va">None</span>,names<span class="op">=</span>fields, usecols<span class="op">=</span>cols, parse_dates<span class="op">=</span>[<span class="st">'date'</span>])</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>    v <span class="op">=</span> dat.loc[dat.visit_game_number<span class="op">==</span><span class="dv">1</span>,].rename(columns<span class="op">=</span><span class="kw">lambda</span> x: x.replace(<span class="st">'visit_'</span>,<span class="st">''</span>)).rename(columns<span class="op">=</span><span class="kw">lambda</span> x: x.replace(<span class="st">'home_'</span>,<span class="st">'opponent_'</span>))</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> dat.loc[dat.home_game_number<span class="op">==</span><span class="dv">1</span>,].rename(columns<span class="op">=</span><span class="kw">lambda</span> x: x.replace(<span class="st">'home_'</span>,<span class="st">''</span>)).rename(columns<span class="op">=</span><span class="kw">lambda</span> x: x.replace(<span class="st">'visit_'</span>,<span class="st">'opponent_'</span>))</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>    games <span class="op">=</span> pd.concat([v,h], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>    games[<span class="st">'outcome'</span>] <span class="op">=</span> games.<span class="bu">apply</span>(assign_outcome,axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>    games[<span class="st">'season'</span>] <span class="op">=</span> year</span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> games</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>teamnames <span class="op">=</span> pd.read_csv(os.path.join(DATADIR,<span class="st">'CurrentNames.csv'</span>), parse_dates<span class="op">=</span>[<span class="st">'first_used'</span>,<span class="st">'last_used'</span>]) </span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1980</span>,<span class="dv">2015</span>):</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> read_in_data(year)</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.concat([df,g], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>teamsgrouped <span class="op">=</span> df.groupby(<span class="st">'team_id'</span>)</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>pct <span class="op">=</span> teamsgrouped.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.outcome.value_counts()<span class="op">/</span>x.outcome.size).<span class="bu">round</span>(<span class="dv">3</span>)<span class="op">*</span><span class="dv">100</span></span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>pct <span class="op">=</span> pct.unstack(<span class="dv">1</span>)</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>pct <span class="op">=</span> pct.sort_values(<span class="st">'W'</span>, ascending<span class="op">=</span><span class="va">False</span>) <span class="co">## decent answer here, but let's merge in team names</span></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>pctteamids <span class="op">=</span> <span class="bu">list</span>(pct.index.values)</span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>pctteams <span class="op">=</span> teamnames[teamnames.hist_franchise_id.isin(pctteamids)].sort_values(<span class="st">'last_used'</span>).drop_duplicates(subset<span class="op">=</span><span class="st">'hist_franchise_id'</span>,keep<span class="op">=</span><span class="st">"last"</span>)</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>finaltable <span class="op">=</span> pct.merge(pctteams, left_index<span class="op">=</span><span class="va">True</span>, right_on<span class="op">=</span><span class="st">'hist_franchise_id'</span>, how<span class="op">=</span><span class="st">"left"</span>).reset_index().assign(Team <span class="op">=</span> <span class="kw">lambda</span> x: x[<span class="st">'location'</span>] <span class="op">+</span> <span class="st">" "</span> <span class="op">+</span> x[<span class="st">'nickname'</span>]).rename(columns<span class="op">=</span>{<span class="st">'W'</span>:<span class="st">'Wins'</span>,<span class="st">'L'</span>:<span class="st">'Losses'</span>})[[<span class="st">'Team'</span>,<span class="st">'Wins'</span>,<span class="st">'Losses'</span>]]</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>HTML(finaltable.to_html(index<span class="op">=</span><span class="va">False</span>))  <span class="co"># alternative to using the itables package</span></span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a><span class="co"># with pd.option_context("display.float_format", "{:,.1f}%".format):</span></span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a><span class="co">#     show(finaltable, dom="lrtp", lengthMenu = [5,10,len(finaltable)]) #paging=False to show full table</span></span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>Here's how I did it:</span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>I downloaded<span class="ot">[^fnmanual]</span> game logs from 1980 -- 2014 from <span class="co">[</span><span class="ot">RetroSheet</span><span class="co">](http://www.retrosheet.org/gamelogs/index.html)</span> and wrote the following script to analyze them. The key was changing the "dyadic" structure of the raw game logs (one row contains information about the two teams playing the game) into one that had one row for each team. I did this in the <span class="in">`read_in_data`</span> function:</span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_in_data(year):</span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>    dat <span class="op">=</span> pd.read_csv(<span class="ss">f"</span><span class="sc">{</span>DATADIR<span class="sc">}</span><span class="ss">/GL</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">.txt"</span>, header<span class="op">=</span><span class="va">None</span>,names<span class="op">=</span>fields, usecols<span class="op">=</span>cols, parse_dates<span class="op">=</span>[<span class="st">'date'</span>])</span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>    v <span class="op">=</span> dat.loc[dat.visit_game_number<span class="op">==</span><span class="dv">1</span>,].rename(columns<span class="op">=</span><span class="kw">lambda</span> x: x.replace(<span class="st">'visit_'</span>,<span class="st">''</span>)).rename(columns<span class="op">=</span><span class="kw">lambda</span> x: x.replace(<span class="st">'home_'</span>,<span class="st">'opponent_'</span>))</span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> dat.loc[dat.home_game_number<span class="op">==</span><span class="dv">1</span>,].rename(columns<span class="op">=</span><span class="kw">lambda</span> x: x.replace(<span class="st">'home_'</span>,<span class="st">''</span>)).rename(columns<span class="op">=</span><span class="kw">lambda</span> x: x.replace(<span class="st">'visit_'</span>,<span class="st">'opponent_'</span>))</span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>    games <span class="op">=</span> pd.concat([v,h], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>    games[<span class="st">'outcome'</span>] <span class="op">=</span> games.<span class="bu">apply</span>(assign_outcome,axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>    games[<span class="st">'season'</span>] <span class="op">=</span> year</span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> games</span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>Here's an example of one year's worth of gamelog data once it's been run through <span class="in">`read_in_data`</span>. 2014 was a bit of an odd season, since the <span class="co">[</span><span class="ot">Dodgers and the Diamondbacks started their seasons on March 22</span><span class="co">](https://www.mlb.com/schedule/2014-03-22)</span> by <span class="co">[</span><span class="ot">playing three exhibition games in Syndey, Australia</span><span class="co">](https://sabr.org/gamesproj/game/march-22-2014-opening-day-down-under-as-dodgers-defeat-diamondbacks/)</span>. Each team went on to be another team's opening day opponent -- the Dodgers faced the Padres and the Diamondbacks went up against the Giants.</span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: page</span></span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>HTML(df[df[<span class="st">'season'</span>] <span class="op">==</span> <span class="dv">2014</span>].sort_values(<span class="st">"date"</span>).drop(columns<span class="op">=</span>[<span class="st">"team_league"</span>, <span class="st">"opponent_team_league"</span>, <span class="st">"season"</span>]).to_html(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>The results table includes two teams that have renamed themselves (the Angels and the Marlins), and one that moved and changed names (Expos). I'd like to update my script to deal with these, but should I really lump the Expos in with the Nats?</span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>Also, I was relieved to see the Dodgers and the Giants were tied, at least.</span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a><span class="ot">[^fnmanual]: </span>I did this manually back in 2015, but as I was porting this to the new site, I wrote a script to automatically download and unzip the files.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>